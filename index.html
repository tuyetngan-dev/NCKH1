<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Website</title>

<head>
  <meta charset="UTF-8">
  <title>My Website</title>
  <link rel="stylesheet" href="style.css">

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

</head>
<body>
  <h1>Ch√†o m·ª´ng ƒë·∫øn v·ªõi ChatBot AIüëã</h1>
  <div class="intro-text">
  <p>T·∫°i ƒë√¢y, tr·ª£ l√≠ s·∫Ω cung c·∫•p cho b·∫°n th√¥ng tin v·ªÅ x√©t tuy·ªÉn ƒê·∫°i h·ªçc, ƒë·ªìng th·ªùi gi√∫p b·∫°n ƒë·ªëi chi·∫øu b·∫£n th√¢n v·ªõi ti√™u ch√≠ c·ªßa tr∆∞·ªùng.</p>
  <p>Hi·ªán t·∫°i, ChatBot c√≥ th√¥ng tin v·ªÅ K·ª≥ thi THPTQG, H∆∞·ªõng d·∫´n ƒëƒÉng k√Ω nguy·ªán v·ªçng x√©t tuy·ªÉn, 4 tr∆∞·ªùng ƒê·∫°i h·ªçc: B√°ch Khoa, C√¥ng ngh·ªá th√¥ng tin, VƒÉn Lang v√† Y D∆∞·ª£c.</p>
  <p>(Th√¥ng tin ƒë∆∞·ª£c c√¥ng c·ª• t·ªïng h·ª£p t·ª´ c√°c trang ch√≠nh th·ªëng v√† c·∫≠p nh·∫≠t ƒë·∫øn th·ªùi gian m·ªõi nh·∫•t.)</p>
</div>


</body>
    <header>
    <h2>H√£y ƒë·∫∑t c√¢u h·ªèi cho ChatBot nh√©!</h2>
    <div class="caution">
    <p>Sau khi g·ª≠i c√¢u h·ªèi, b·∫°n vui l√≤ng ch·ªù m·ªôt ch√∫t ƒë·ªÉ ChatBot tr·∫£ l·ªùi nh√©</p>
    </div>
  </header>

  <main>
    <div id="chatbox"></div>
    <div id="inputArea">
      <input type="text" id="userInput" placeholder="Nh·∫≠p c√¢u h·ªèi...">
      <button id="sendBtn">G·ª≠i</button>
    </div>
  </main>

  <footer>
    <p>¬© 2025 tuyetngan</p>
  </footer>

  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    const API_KEY = "AIzaSyD_JNEm2QjjEPVDSyYeFKGmZ5mRj1ah-N4";
    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({ model: "gemini-2.5-pro" });

    const chatbox = document.getElementById("chatbox");
    const input = document.getElementById("userInput");
    document.getElementById("sendBtn").addEventListener("click", sendMessage);

    // L·ªãch s·ª≠ chat 
    let chatHistory = [];

    // Prompt h·ªá th·ªëng ƒë·ªÉ ƒë·ªãnh h∆∞·ªõng bot
    const systemPrompt = "B·∫°n l√† Chatbot t∆∞ v·∫•n thi c·ª≠, ch·ªâ tr·∫£ l·ªùi v·ªÅ k·ª≥ thi THPTQG v√† tuy·ªÉn sinh ƒê·∫°i h·ªçc t·∫°i Vi·ªát Nam. N·∫øu c√¢u h·ªèi kh√¥ng li√™n quan th√¨ h√£y n√≥i: 'Xin l·ªói, t√¥i kh√¥ng bi·∫øt'";

    async function sendMessage() {
      const userMsg = input.value.trim();
      if (!userMsg) return;

      // Hi·ªÉn th·ªã tin nh·∫Øn user
      chatbox.innerHTML += `<div class="msg user">B·∫°n: ${userMsg}</div>`;
      input.value = "";
      chatbox.scrollTop = chatbox.scrollHeight;

      // Th√™m v√†o l·ªãch s·ª≠
      chatHistory.push({ role: "user", text: userMsg });

      try {
        // Gh√©p to√†n b·ªô l·ªãch s·ª≠ th√†nh prompt
        let historyText = systemPrompt + "\n\n";
        chatHistory.forEach((msg) => {
          historyText +=
            (msg.role === "user" ? "Ng∆∞·ªùi d√πng: " : "Bot: ") + msg.text + "\n";
        });

        console.log("Prompt g·ª≠i ƒëi:", historyText);

        const result = await model.generateContent(historyText);
        const botReply = result.response.text();
        console.log("Bot tr·∫£ l·ªùi:", botReply);

        // Chuy·ªÉn Markdown -> HTML b·∫±ng marked.js
        const botHtml = marked.parse(botReply);

        // Hi·ªÉn th·ªã bot tr·∫£ l·ªùi
        chatbox.innerHTML += `<div class="msg bot">${botHtml}</div>`;
        chatbox.scrollTop = chatbox.scrollHeight;

        // Th√™m v√†o l·ªãch s·ª≠
        chatHistory.push({ role: "bot", text: botReply });
      } catch (err) {
        console.error("C√≥ l·ªói x·∫£y ra:", err);
        chatbox.innerHTML += `<div class="msg bot">[L·ªói: ${err.message}]</div>`;
      }
    }

    // Cho ph√©p b·∫•m Enter ƒë·ªÉ g·ª≠i
    input.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        sendMessage();
      }
    });
  </script>
</body>
</html>

